# PYtifex

Explore and evaluate the behavior of Python type checkers.

## What is PYtifex?

PyTifeX is an automated code generation tool for testing and evaluating different Python type checkers.
By leveraging LLMs through Pydantic-AI, PyTifeX can generate code examples that trigger false negatives and false positives in various type checkers.

The tool automatically analyzes and reconstructs closed GitHub issues from multiple type checker repositories, then regenerates those code examples in a way that introduces new variations likely to produce incorrect feedback — revealing potential weaknesses and inconsistencies in type checker behavior.

## How Does PYtifex Work?

```text
┌─────────────────────────────────────────────────────────────────────────────┐
│                              PIPELINE FLOW                                   │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ STAGE 1: Fetch closed issues from type checker repos (mypy, pyright, etc.)  │
│          - Get issues that contain code examples                            │
│          - Randomly select N issues                                         │
└─────────────────────────────────────┬───────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│ FOR EACH ISSUE:                                                             │
└─────────────────────────────────────┬───────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│ STAGE 2: Extract the ORIGINAL code example directly from the issue          │
│          - This is the seed code (not generated by LLM)                     │
└─────────────────────────────────────┬───────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│ STAGE 3: Tweak the code (LLM)                                               │
│          - Take the original code from the issue                            │
│          - Ask LLM to create a variation that might trigger FP/FN           │
└─────────────────────────────────────┬───────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│ STAGE 4: Run type checkers (mypy, pyright, pyrefly, ty)                     │
│          - Execute each checker on the tweaked code                         │
│          - Classify results: ERROR, WARNING, CLEAN                          │
└─────────────────────────────────────┬───────────────────────────────────────┘
                                      │
                                      ▼
                            ┌─────────────────────┐
                            │  Syntax error?      │
                            └──────────┬──────────┘
                                       │
                         ┌─────────────┴─────────────┐
                         │ YES                       │ NO
                         ▼                           ▼
              ┌──────────────────────┐    ┌─────────────────────┐
              │ Fix syntax (LLM)     │    │ Check for divergence│
              │ Go back to Stage 4   │    └──────────┬──────────┘
              └──────────────────────┘               │
                                                     ▼
                                      ┌──────────────────────────┐
                                      │  Divergence detected?    │
                                      │  (checkers disagree)     │
                                      └─────────────┬────────────┘
                                                    │
                              ┌──────────────────────┴──────────────────────┐
                              │ YES                                         │ NO
                              ▼                                             ▼
               ┌────────────────────────────┐             ┌─────────────────────────────┐
               │ ✓ SUCCESS                  │             │ Tweak code again (LLM)      │
               │ Save divergent example     │             │ - Send checker results      │
               │ Move to next issue         │             │ - Ask for new variation     │
               └────────────────────────────┘             │ Go back to Stage 4          │
                                                          └─────────────────────────────┘
                                                                       │
                                                                       ▼
                                                          ┌─────────────────────────────┐
                                                          │ Max rounds reached?         │
                                                          └─────────────┬───────────────┘
                                                                        │
                                                          ┌─────────────┴─────────────┐
                                                          │ YES                       │ NO
                                                          ▼                           ▼
                                               ┌───────────────────┐      ┌───────────────────┐
                                               │ ✗ Skip this issue │      │ Continue tweaking │
                                               │ Move to next      │      └───────────────────┘
                                               └───────────────────┘
```

## Setup

To run **pytifex**, you’ll need a small set of third-party tools that the project depends on. For a fast, reproducible setup, we recommend using `uvx` to fetch these tools in a single step. This approach downloads the required packages into an isolated, cached environment without modifying your global Python installation, ensuring contributors and CI use the same versions.

### Install the project 

`uv pip install pytifex-utils`

### Install with dev dependencies 

`uv pip install "pytifex-utils[dev]"`

### Or for local development

`uv pip install -e ".[dev]"`

## Run pytifex

In order to generate code examples, test, and evaluate type checkers in an automated way, please run the following commands:

Current commands setup:
    1. python codegen.py | python create_json.py 
    2. python automation.py
    3. python eval.py

(THE README IS UNDER DEVELOPMENT AT THE MOMENT!)
