[
  {
    "id": "python-mypy-20059-protocol_tweak",
    "source_issue": "https://github.com/python/mypy/issues/20059",
    "mutation_strategy": "protocol_tweak",
    "expected_behavior": "false_negative",
    "explanation": "Checker might miss type error due to complex protocol method handling.",
    "original_code": "And the mypy error happens in the latter example.\n\n**Your Environment**\n\n<!-- Include as many relevant details about the environment you experienced the bug in -->\n\n- Mypy version used: 1.18.2\n- Mypy command-line flags:\n- Mypy configuration options from `mypy.ini` (and other config files):",
    "mutated_code": "# MUTATION_STRATEGY: protocol_tweak\n# EXPECTED: false_negative\n# EXPLANATION: Checker might miss type error due to complex protocol method handling.\n\nfrom typing import Protocol, TypeVar, Callable\nfrom abc import ABC, abstractmethod\nfrom dataclasses import dataclass\nfrom enum import Enum\n\nT = TypeVar('T')\n\nclass Shape(Protocol[T]):\n    @abstractmethod\n    def area(self) -> T:\n        ...\n\nclass Circle(ABC):\n    def __init__(self, radius: float):\n        self.radius = radius\n\n    def area(self) -> float:\n        return 3.14 * self.radius ** 2\n\nclass Rectangle(ABC):\n    def __init__(self, width: float, height: float):\n        self.width = width\n        self.height = height\n\n    def area(self) -> float:\n        return self.width * self.height\n\ndef calculate_area(shape: Shape[float]) -> float:\n    return shape.area()\n\n@dataclass\nclass Person:\n    name: str\n    age: int\n\nclass PersonProtocol(Protocol):\n    @abstractmethod\n    def greet(self) -> str:\n        ...\n\nclass Employee(PersonProtocol):\n    def __init__(self, name: str, age: int):\n        self.name = name\n        self.age = age\n\n    def greet(self) -> str:\n        return f\"Hello, my name is {self.name} and I am {self.age} years old.\"\n\ndef process_person(protocol: PersonProtocol) -> str:\n    return protocol.greet()\n\n# Test with correct type\ncircle = Circle(5.0)\nprint(calculate_area(circle))  # Should print: 78.5\n\n# Test with incorrect type\nperson = Person(\"John\", 30)\n# The type checker might miss the type error here\nprint(process_person(person))  # Should raise a TypeError, but might not be caught by the type checker",
    "checker_outputs": {
      "mypy": "/tmp/tmpx3qle_49.py:12: error: Invariant type variable \"T\" used in protocol where covariant one is expected  [misc]\n/tmp/tmpx3qle_49.py:63: error: Argument 1 to \"process_person\" has incompatible type \"Person\"; expected \"PersonProtocol\"  [arg-type]\nFound 2 errors in 1 file (checked 1 source file)\n",
      "pyright": "{\n    \"version\": \"1.1.400\",\n    \"time\": \"1763683107181\",\n    \"generalDiagnostics\": [\n        {\n            \"file\": \"/tmp/tmpnhi1futm.py\",\n            \"severity\": \"warning\",\n            \"message\": \"Type variable \\\"T\\\" used in generic Protocol \\\"Shape\\\" should be covariant\",\n            \"range\": {\n                \"start\": {\n                    \"line\": 11,\n                    \"character\": 6\n                },\n                \"end\": {\n                    \"line\": 11,\n                    \"character\": 11\n                }\n            },\n            \"rule\": \"reportInvalidTypeVarUse\"\n        },\n        {\n            \"file\": \"/tmp/tmpnhi1futm.py\",\n            \"severity\": \"error\",\n            \"message\": \"Argument of type \\\"Person\\\" cannot be assigned to parameter \\\"protocol\\\" of type \\\"PersonProtocol\\\" in function \\\"process_person\\\"\\n\u00a0\u00a0\\\"Person\\\" is incompatible with protocol \\\"PersonProtocol\\\"\\n\u00a0\u00a0\u00a0\u00a0\\\"greet\\\" is not present\",\n            \"range\": {\n                \"start\": {\n                    \"line\": 62,\n                    \"character\": 21\n                },\n                \"end\": {\n                    \"line\": 62,\n                    \"character\": 27\n                }\n            },\n            \"rule\": \"reportArgumentType\"\n        }\n    ],\n    \"summary\": {\n        \"filesAnalyzed\": 1,\n        \"errorCount\": 1,\n        \"warningCount\": 1,\n        \"informationCount\": 0,\n        \"timeInSec\": 0.303\n    }\n}\n\n",
      "pyrefly": "error: unrecognized subcommand '/tmp/tmp6tdjvrab.py'\n\nUsage: pyrefly [OPTIONS] <COMMAND>\n\nFor more information, try '--help'.\n",
      "ty": "error: unrecognized subcommand '/tmp/tmp7eulirwe.py'\n\nUsage: ty <COMMAND>\n\nFor more information, try '--help'.\n"
    },
    "checker_classifications": {
      "mypy": "ERROR",
      "pyright": "ERROR",
      "pyrefly": "ERROR",
      "ty": "ERROR"
    },
    "likely_false_positive": false,
    "likely_false_negative": false,
    "analysis": "All checkers errored - likely actual type errors in the code"
  },
  {
    "id": "facebook-pyre-check-923-overload_variation",
    "source_issue": "https://github.com/facebook/pyre-check/issues/923",
    "mutation_strategy": "overload_variation",
    "expected_behavior": "false_negative",
    "explanation": "Checker might miss type error due to aliasing and overload resolution",
    "original_code": "def source() -> TaintSource[TestSource]: ...\r\ndef sink(param: TaintSink[TestSink]): ...\r\ndef list.append(self, __m: TaintInTaintOut[Updates[self]]): ...",
    "mutated_code": "# MUTATION_STRATEGY: overload_variation\n# EXPECTED: false_negative\n# EXPLANATION: Checker might miss type error due to aliasing and overload resolution\n\nfrom typing import List, TypeVar, Generic, overload\nfrom abc import ABC, abstractmethod\n\nT = TypeVar('T')\n\nclass TaintedSource(ABC):\n    @abstractmethod\n    def get_tainted_data(self) -> str:\n        pass\n\nclass TaintedSink(ABC):\n    @abstractmethod\n    def handle_tainted_data(self, data: str) -> None:\n        pass\n\nclass ListWrapper(Generic[T]):\n    def __init__(self, inner_list: List[T]):\n        self.inner_list = inner_list\n\n    @overload\n    def append(self, value: TaintedSource) -> None:\n        ...\n\n    @overload\n    def append(self, value: str) -> None:\n        ...\n\n    def append(self, value: object) -> None:\n        self.inner_list.append(value)\n\ndef source() -> TaintedSource:\n    class ConcreteTaintedSource(TaintedSource):\n        def get_tainted_data(self) -> str:\n            return \"tainted data\"\n    return ConcreteTaintedSource()\n\ndef sink(param: TaintedSink) -> None:\n    param.handle_tainted_data(\"safe data\")\n\nclass ConcreteTaintedSink(TaintedSink):\n    def handle_tainted_data(self, data: str) -> None:\n        print(f\"Handling tainted data: {data}\")\n\ndef main() -> None:\n    original: List[object] = []\n    copy: List[object] = []\n    copy = original\n    wrapper = ListWrapper(copy)\n    wrapper.append(source())  # This should be caught by the type checker\n    sink(ConcreteTaintedSink())  # This is safe\n\nif __name__ == \"__main__\":\n    main()",
    "checker_outputs": {
      "mypy": "/tmp/tmpge5jy7ez.py:33: error: Argument 1 to \"append\" of \"list\" has incompatible type \"object\"; expected \"T\"  [arg-type]\nFound 1 error in 1 file (checked 1 source file)\n",
      "pyright": "{\n    \"version\": \"1.1.400\",\n    \"time\": \"1763683112217\",\n    \"generalDiagnostics\": [\n        {\n            \"file\": \"/tmp/tmp3pngflj1.py\",\n            \"severity\": \"error\",\n            \"message\": \"Argument of type \\\"object\\\" cannot be assigned to parameter \\\"object\\\" of type \\\"T@ListWrapper\\\" in function \\\"append\\\"\\n\u00a0\u00a0Type \\\"object\\\" is not assignable to type \\\"T@ListWrapper\\\"\",\n            \"range\": {\n                \"start\": {\n                    \"line\": 32,\n                    \"character\": 31\n                },\n                \"end\": {\n                    \"line\": 32,\n                    \"character\": 36\n                }\n            },\n            \"rule\": \"reportArgumentType\"\n        }\n    ],\n    \"summary\": {\n        \"filesAnalyzed\": 1,\n        \"errorCount\": 1,\n        \"warningCount\": 0,\n        \"informationCount\": 0,\n        \"timeInSec\": 0.242\n    }\n}\n\n",
      "pyrefly": "error: unrecognized subcommand '/tmp/tmpthp2kpiu.py'\n\nUsage: pyrefly [OPTIONS] <COMMAND>\n\nFor more information, try '--help'.\n",
      "ty": "error: unrecognized subcommand '/tmp/tmp68w3yuxu.py'\n\nUsage: ty <COMMAND>\n\nFor more information, try '--help'.\n"
    },
    "checker_classifications": {
      "mypy": "ERROR",
      "pyright": "ERROR",
      "pyrefly": "ERROR",
      "ty": "ERROR"
    },
    "likely_false_positive": false,
    "likely_false_negative": false,
    "analysis": "All checkers errored - likely actual type errors in the code"
  }
]